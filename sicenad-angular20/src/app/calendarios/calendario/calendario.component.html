<div class="p-4 max-w-4xl mx-auto">
  <h1 class="text-2xl font-bold mb-4">Calendario Angular con API y colores</h1>
  <!-- Leyenda de colores -->
  <div class="flex gap-6 mb-4">
    @for (tipo of tiposEventos; track tipo) {
    <div class="flex items-center gap-2">
      <!-- Cuadro de color -->
      <div
        [ngStyle]="{ 'background-color': EVENT_COLORS[tipo].primary }"
        style="
          width: 16px;
          height: 16px;
          border-radius: 4px;
          border: 1px solid #ccc;
          display: inline-block;
        "
      ></div>
      <!-- Texto -->
      <span class="text-sm capitalize">{{ tipo }}</span>
    </div>
    }
  </div>
  <!-- Formulario para crear/editar evento -->
  <form
    [formGroup]="eventoForm"
    (ngSubmit)="agregarEvento()"
    class="mb-6 border rounded p-4 bg-gray-50"
  >
    <h2 class="text-lg font-semibold mb-3">Crear / Editar Evento</h2>
    <div class="mb-3">
      <label class="block text-sm font-medium">Título</label>
      <input type="text" formControlName="title" class="border rounded w-full p-2" />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-medium">Fecha de inicio</label>
      <input type="datetime-local" formControlName="start" class="border rounded w-full p-2" />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-medium">Fecha de fin</label>
      <input type="datetime-local" formControlName="end" class="border rounded w-full p-2" />
    </div>
    <div class="mb-3">
      <label class="block text-sm font-medium">Descripción</label>
      <textarea formControlName="description" class="border rounded w-full p-2"></textarea>
    </div>
    <div class="mb-3">
      <label class="block text-sm font-medium">Tipo de evento</label>
      <select formControlName="tipo" class="border rounded w-full p-2">
        <option *ngFor="let tipo of tiposEventos" [value]="tipo">{{ tipo }}</option>
      </select>
    </div>
    <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded">
      {{ editingEvent ? 'Editar Evento' : 'Agregar Evento' }}
    </button>
  </form>
  <!-- Controles de navegación y calendario -->
  <div class="flex items-center gap-2 mb-4">
    <button class="px-3 py-1 bg-gray-200 rounded" (click)="previous()">Anterior</button>
    <button class="px-3 py-1 bg-gray-200 rounded" (click)="today()">Hoy</button>
    <button class="px-3 py-1 bg-gray-200 rounded" (click)="next()">Siguiente</button>
    <div class="ml-auto flex gap-2">
      <button
        class="px-3 py-1 bg-blue-500 text-white rounded"
        [class.bg-blue-700]="view === CalendarView.Month"
        (click)="setView(CalendarView.Month)"
      >
        Mes
      </button>
      <button
        class="px-3 py-1 bg-blue-500 text-white rounded"
        [class.bg-blue-700]="view === CalendarView.Week"
        (click)="setView(CalendarView.Week)"
      >
        Semana
      </button>
      <button
        class="px-3 py-1 bg-blue-500 text-white rounded"
        [class.bg-blue-700]="view === CalendarView.Day"
        (click)="setView(CalendarView.Day)"
      >
        Día
      </button>
    </div>
  </div>
  <!-- Título del mes -->
  <h2 class="text-xl font-bold mb-4 text-center">
    {{ viewDate | date : 'MMMM yyyy' }}
  </h2>
  <!-- Vista del calendario -->
  <div class="border rounded p-2 relative">
    @if (loading) {
    <div class="absolute inset-0 bg-white/80 flex items-center justify-center">
      <span class="text-gray-500">Cargando eventos...</span>
    </div>
    } @switch (view) { @case (CalendarView.Month) {
    <mwl-calendar-month-view
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="handleEvent($event.event)"
    >
    </mwl-calendar-month-view>
    } @case (CalendarView.Week) {
    <mwl-calendar-week-view
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="handleEvent($event.event)"
    >
    </mwl-calendar-week-view>
    } @case (CalendarView.Day) {
    <mwl-calendar-day-view
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="handleEvent($event.event)"
    >
    </mwl-calendar-day-view>
    } }
  </div>
  <!-- Detalles del evento -->
  @if (selectedEvent) {
  <div class="mt-4 p-4 border rounded bg-gray-50">
    <h2 class="text-lg font-semibold">Detalles del evento</h2>
    <p><strong>Título:</strong> {{ selectedEvent.title }}</p>
    <p><strong>Inicio:</strong> {{ selectedEvent.start | date : 'short' }}</p>
    @if (selectedEvent.end) {
    <p><strong>Fin:</strong> {{ selectedEvent.end | date : 'short' }}</p>
    } @if (selectedEvent.meta?.description) {
    <p><strong>Descripción:</strong> {{ selectedEvent.meta.description }}</p>
    }
    <p><strong>Tipo:</strong> {{ selectedEvent.meta?.tipo }}</p>
    <button
      class="mt-2 px-3 py-1 bg-red-500 text-white rounded"
      (click)="borrarEvento(selectedEvent)"
    >
      Eliminar
    </button>
  </div>
  }
</div>
