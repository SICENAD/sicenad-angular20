<div class="container mt-4">
  <app-calendarHeader [view]="view()" [viewDate]="viewDate()" (viewChange)="view.set($event)"
    (viewDateChange)="viewDate.set($event)" />
  <!-- Calendario dinÃ¡mico -->
  <div class="card shadow p-3 mb-4">
    @switch (view()) { @case ('month') {
    <mwl-calendar-month-view [viewDate]="viewDate()" [events]="events()" [refresh]="refresh"
      [cellTemplate]="customMonthCell" [activeDayIsOpen]="true" [weekStartsOn]="1"
      (eventClicked)="onEventClick($event.event)" [locale]="locale()" />
    } @case ('week') {
    <mwl-calendar-week-view [viewDate]="viewDate()" [events]="events()" [refresh]="refresh" [weekStartsOn]="1"
      (eventClicked)="onEventClick($event.event)" [locale]="locale()" />
    } @case ('day') {
    <mwl-calendar-day-view [viewDate]="viewDate()" [events]="events()" [refresh]="refresh"
      (eventClicked)="onEventClick($event.event)" [locale]="locale()" />
    } }
  </div>
  <!-- Tabla con listado de eventos -->
  <div class="mt-4">
    <h4 class="text-center">{{ 'solicitudes.listadoSolicitudes' | translate }}</h4>
    @if (eventosVisibles.length === 0) {
    <p class="text-center text-muted">{{ 'solicitudes.noSolicitudes' | translate }}</p>
    } @else {
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>{{ 'solicitudes.inicio' | translate }}</th>
            <th>{{ 'solicitudes.fin' | translate }}</th>
            <th>{{ 'solicitudes.unidad' | translate }}</th>
            <th>{{ 'solicitudes.estado' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          @for (evento of eventosVisibles; track evento.id) {
          <tr>
            <td>{{ evento.start | date : 'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ evento.end | date : 'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ evento.title }}</td>
            <td>{{ evento.meta.estado }}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }
  </div>
</div>
<ng-template #customMonthCell let-day="day">
  <div class="cal-cell-top">
    <span class="cal-day-number">{{ day.date | date : 'd' }}</span>
  </div>
  <div class="cal-events-day">
    @for (event of day.events; track event.idString) {
    <div class="cal-event-bar" [ngStyle]="getEventStyle(event, day.date)" (click)="onEventClick(event)">
      {{ event.title }}
    </div>
    }
  </div>
</ng-template>