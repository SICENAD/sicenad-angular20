<div class="container mt-4">
  <div class="d-flex align-items-center position-relative mb-2 pb-3">
  <!-- Contenedor de botones en columna -->
  <div class="position-absolute start-0 d-flex flex-column">
    <!-- Botón volver a solicitudes -->
    <a
      class="nav-link volver"
      [routerLink]="[routesPaths.cenadHome, cenadVisitado()?.idString, routesPaths.solicitudes]"
    >
      <fa-icon class="fa-2x volver" [icon]="faVolver"></fa-icon>
      <strong>{{ 'solicitudes.volverSolicitudes' | translate }}</strong>
    </a>
    <!-- Botón volver al calendario -->
    <a
      class="nav-link volver"
      [routerLink]="[routesPaths.cenadHome, cenadVisitado()?.idString, routesPaths.calendario]"
    >
      <fa-icon class="fa-2x volver" [icon]="faVolver"></fa-icon>
      <strong>{{ 'solicitudes.volverCalendario' | translate }}</strong>
    </a>
  </div>
  <!-- Título centrado -->
  <h1 class="w-100 text-center mb-0">
    {{ 'solicitudes.solicitudRecurso' | translate | uppercase}}: {{ recurso()?.nombre | uppercase}}
  </h1>
</div>

  <div class="formulario pb-3" #topScroll>
    <form [formGroup]="solicitudForm" class="formulario">
      <!--cuando se abra como no editable todo el form sera de lectura-->
      <fieldset [disabled]="!isEditable()">
        <div class="row py-2 justify-content-between">
          <div class="col-lg-2 col-md-12">
            <label class="me-2">{{ 'solicitudes.unidad' | translate | uppercase }} <sup class="text-danger">*</sup></label>
            <label class="form-control">{{ solicitud()?.unidadUsuaria }}</label>
          </div>
          <div class="col-lg-2 col-md-12">
            <label>{{ 'solicitudes.jefeUnidad' | translate | uppercase }} <sup class="text-danger">*</sup></label>
            <input
              type="text"
              class="form-control"
              formControlName="jefeUnidadUsuaria"
              placeholder="{{ 'solicitudes.jefeUnidad' | translate }}"
              name="jefeUcoUsuaria"
            />
            @if (jefeUnidadUsuaria?.touched && jefeUnidadUsuaria?.invalid) {
            <span class="text-danger">{{ 'solicitudes.jefeObligatorio' | translate }}</span>
            }
          </div>
          <div class="col-lg-2 col-md-12">
            <label for="fechaSolicitud">{{ 'solicitudes.fechaSolicitud' | translate | uppercase }}</label>
            <input
              type="date"
              class="form-control"
              formControlName="fechaSolicitud"
              name="fechaSol"
              readonly
            />
          </div>
          <div class="col-lg-2 col-md-12">
            <label>{{ 'solicitudes.poc' | translate | uppercase }}: <sup class="text-danger">*</sup></label>
            <input
              type="text"
              class="form-control"
              formControlName="pocEjercicio"
              placeholder="{{ 'solicitudes.poc' | translate }}"
              name="pocEjercicio"
            />
            @if (pocEjercicio?.touched && pocEjercicio?.invalid) {
            <span class="text-danger">{{ 'solicitudes.pocObligatorio' | translate }}</span>
            }
          </div>
          <div class="col-lg-2 col-md-12">
            <label>{{ 'solicitudes.tlfnRedactor' | translate | uppercase }} <sup class="text-danger">*</sup></label>
            <input
              type="text"
              class="form-control"
              formControlName="tlfnRedactor"
              placeholder="{{ 'solicitudes.tlfnRedactor' | translate }}"
              name="tlfnRedactor"
            />
            @if (tlfnRedactor?.touched && tlfnRedactor?.invalid) {
            <span class="text-danger">{{ 'comun.telefonoObligatorio' | translate }}</span>
            }
          </div>
        </div>
        <div class="row py-2 mt-2 justify-content-between">
          <div class="col-lg-4 col-md-12">
            <label>{{ 'solicitudes.recurso' | translate | uppercase }} <sup class="text-danger me-2">*</sup></label>
            <label class="form-control">{{ recurso()?.nombre }}</label>
          </div>
          <div class="col-lg-2 col-md-12">
            <label for="fechaInicio">{{ 'solicitudes.fechaInicio' | translate | uppercase }} <sup class="text-danger"></sup></label>
            <input type="datetime-local" class="form-control" formControlName="fechaInicio" />
            @if (fechaInicio?.touched && fechaInicio?.invalid) {
            <span class="text-danger">{{ 'solicitudes.fechaObligatoria' | translate }}</span>
            }
          </div>
          <div class="col-lg-2 col-md-12">
            <label for="fechaFin">{{ 'solicitudes.fechaFin' | translate | uppercase }} <sup class="text-danger"></sup></label>
            <input type="datetime-local" class="form-control" formControlName="fechaFin" />
            @if (fechaFin?.touched && fechaFin?.invalid) {
            <span class="text-danger">{{ 'solicitudes.fechaObligatoria' | translate }}</span>
            }
          </div>
        </div>
        <div class="row py-2 mt-2 justify-content-center me-3">
          <div class="col-lg-12 col-md-12">
            <label>{{ 'solicitudes.observaciones' | translate | uppercase }}</label>
            <textarea
              class="form-control"
              name="observaciones"
              formControlName="observaciones"
              placeholder="{{ 'solicitudes.observaciones' | translate }}"
            >
            </textarea>
          </div>
        </div>
        <div class="row py-2 mt-2 justify-content-center me-3">
          <div class="col-lg-12 col-md-12">
            <label>{{ 'solicitudes.observacionesCenad' | translate | uppercase }}</label>
            <textarea
              class="form-control"
              name="observacionesCenad"
              formControlName="observacionesCenad"
              placeholder="{{ 'solicitudes.observacionesCenad' | translate }}"
              [readOnly]="!isAdminEsteCenad() && !isGestorEsteCenad()"
            >
            </textarea>
          </div>
        </div>
        <div class="row py-2 mt-2 justify-content-start">
          <div class="col-auto d-flex align-items-center">
            <label class="me-2 mb-0">
              <b>{{ 'solicitudes.estado' | translate | uppercase }}</b>
            </label>
            <select
              class="form-select form-select-sm w-auto"
              aria-label="estado"
              formControlName="estado"
            >
              @for (e of estados(); track e) {
              <option [ngValue]="e">
                {{ e }}
              </option>
              }
            </select>
          </div>
        </div>
        <div class="row py-2 mt-2 justify-content-start">
          <div class="col-auto d-flex align-items-center">
            <label class="me-2 mb-0">
              <b>{{ 'solicitudes.fechaFinDocumentacion' | translate | uppercase }}</b>
            </label>
            <input
              type="date"
              class="form-control w-auto"
              formControlName="fechaFinDocumentacion"
              name="fechaFinDocumentacion"
              [readOnly]="!isAdminEsteCenad() && !isGestorEsteCenad()"
            />
          </div>
        </div>
      </fieldset>
    </form>
    <div class="mb-4">
      <app-ficherosSolicitud
        [isCenad]="true"
        [documentacion]="documentacionCenad()"
        [idSolicitud]="solicitud()?.idString"
        [solicitud]="solicitud()"
        (output)="recargarDocumentacionCenad()"
      />
    </div>
    <div>
      <app-ficherosSolicitud
        [isCenad]="false"
        [documentacion]="documentacionUnidad()"
        [idSolicitud]="solicitud()?.idString"
        [solicitud]="solicitud()"
        (output)="recargarDocumentacionUnidad()"
      />
    </div>
  </div>
  <div class="mt-3">
    @if (isEditable()) {
    <button
      class="btn me-2"
      [attr.data-bs-target]="'#' + idModalEliminar()"
      data-bs-toggle="modal"
    >
      {{ 'solicitudes.borrar' | translate }}
    </button>
    <button
      type="button"
      (click)="editarSolicitud()"
      class="btn"
      [disabled]="solicitudForm.invalid"
    >
      {{ 'solicitudes.guardar' | translate }}
    </button>
    }
  </div>
</div>
<!-- Modal para eliminar-->
<div class="modal fade" [id]="idModalEliminar()" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="confirmaEliminar-Label">
          {{ 'solicitudes.eliminar' | translate: { recurso: recurso()?.nombre } }}
        </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">{{ 'solicitudes.confirmarBorrado' | translate: { recurso: recurso()?.nombre } }}</div>
      <div class="modal-footer">
        <button type="button" class="btn" data-bs-dismiss="modal">{{ 'comun.cerrar' | translate }}</button>
        <button
          type="button"
          (click)="borrarSolicitud()"
          data-bs-dismiss="modal"
          class="btn"
        >
          {{ 'comun.borrar' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
